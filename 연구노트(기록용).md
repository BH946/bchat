# 연구노트

형식 없이 마음대로 작성하는 구현 과정 기록용 노트

**https://docs.oracle.com/en/java/javase/17/docs/api/java.sql/java/sql/PreparedStatement.html**

**자바 공홈 항상 참고**

<br><br>

## 2024-09-07 - 하루종일 오라클과 싸움 ㅜ

소켓이나 swing이나 다들 내장된 기본 라이브러리이므로 추가 build.gradle에 할게 없을거다.

create sql문에 id값은 자동 기입? -> MySQL은 Auto.. **오라클은 시퀀스 사용(or 12c부터 IDENTITY 제공).**

JPA나 lombok 없이 개발할 거임.

**오라클.. 연동..**

- 오라클은 서버쪽 DB 그 자체 인 것 같고, 오라클 클라이언트는 이 DB를 접근하는 용도 인 것 같다.

- 오렌지는 데이터 분석 및 시각화 도구인데 오라클 클라이언트가 있어야 연결이 되는것 같다.?

  - **이것에 관한 정보?!! 아래 읽어보면 이해 됨!** [참고](https://okky.kr/questions/206807)
  - **오라클 DBM 클라이언트에는 오라클 DBM 서버에 접속할 수 있는 프로그램들이 내장**되어 있습니다. 그런데, Java 에서는 DB 에 상관없이 JDBC 라는 드라이버를 통해 직접 DB 에 연결하는 표준을 가지고 있습니다. 오라클도 이 JDBC 드라이버를 제공하고 있는 것입니다. 즉, Oracle Clinet 의 접속 관련 부분이 JDBC 에 구현되어 있고, 그 외 SQL*PLUS 같은 툴들은 없습니다. JDBC 을 내장해서 관리하는 것이 구현된 것이 SQLDeveloper (Java로 만듦) 이구요. 단순히 Java 환경에서는 JDBC 만 있으면 되므로 Oracle client 는 필요없고, Java 가 아닌 토트, 오렌지 등에서는 Oracle Clinet 가 있어야 하는 거구요. 일부 툴에서는 Oracle Client 와 같이 많은 것을 설치해야만 사용 가능하지만, 일부 툴은 Oracle instant client 와 같이 설치 없이 간단한 설정 만으로 접속을 가능하게 해주는 JDBC 와 같은 것으로 연결이 가능합니다. 토드 최신 버젼 등은 지원할 겁니다. (12년 전 자료. 아마 지금은 지원 하는게 대부분 일 거다.)

- **즉, 오라클 + 오라클 클라이언트 + 오렌지** 를 설치!! **버전: 19LTS+11+7**

- **[Orange 7.0](https://www.warevalley.com/ko/support/download-list) -> 만약 [오렌지](https://devcami.tistory.com/29) 연동 잘 안 되면 [SQL Developer](https://ddcloud.tistory.com/entry/Oracle-1-4-%EC%9E%91%EC%97%85%ED%99%98%EA%B2%BD-%EA%B5%AC%EC%B6%95%ED%95%98%EA%B8%B0-2-Oracle-SQL-Developer-%EC%84%A4%EC%B9%98) 설치 해보기. 그것도 안 되면 걍 sqlplus로..**

- [설치에 관리자 권한 오류 발생](https://sense-of-accomplishment.tistory.com/118)
    - 관리자 권한을 해도 안 됨. 21c 버전 잘 안되네 ㅠ virtualbox 에서 해야할 듯.
    - 근데 이건 desktop으로 해야함. 용량이 없어서ㅠ
    - 19c 버전 되는지 다시 다운 받아보겠음.
  - **oracle database download 검색 + oracle database client download 검색 -> 19c, 11 버전**
    - **[유튜브 참고](https://www.youtube.com/watch?v=F4ABJrTsMSI&list=PLKaW9UT2TL3JcuffIyG1DJ_DXdShH-4u1&index=1&pp=iAQB), 오라클 클라이언트 못찾겠어서 여기서 다운 -> [Oracle Software Delivery Cloud](https://edelivery.oracle.com/osdc/faces/SoftwareDelivery)**
      - [이 블로그에서 링크 참고한 것](https://velog.io/@yeoonnii/Oracle-%EC%98%A4%EB%9D%BC%ED%81%B4-19c-%EC%84%A4%EC%B9%98%EB%8B%A4%EC%9A%B4%EB%A1%9C%EB%93%9C)
    - 소프트웨어만 설치로 간단히 설치 후 Database Configuration Assistant 실행(=dbca)
      - "관리자권한" cmd-dbca실행: db 이름 STR, SGA(1024),PGA(128) 에서 에러. 메모리 확인이 왜 안 된다지?
      - `dbca -J-Doracle.assistants.dbca.validate.ConfigurationParams=false` 로 dbca 실행 시 해결!!!@@
      - 계정 비밀번호 oracle로 설정했음
    - **sqlplus**
      - lsnrctl status 로 리스너 확인 - 잘 연결되어 있는 상태
      - sqlplus / as sysdba 로 db 접속 (sysdba는 root 권한)
      - select instance_name from v$instance; 로 db 잘 생성 되었나 db명 체크
      - exit 로 탈출
      - **db start?**
        - sqlplus / as sysdba 로 root로 접속 후
        - startup 로 db 실행
        - lsnrctl start 로 리스너 실행!
      - **db stop?**
        - lsnrctl stop 로 외부 접속 가능하게 해주는 리스너 종료
        - sqlplus / as sysdba 로 root로 접근 후 
        - shutdown immediate 로 db 종료
      - **services.msc 윈도우 서비스 화면 이동**
        - 오라클이 자동으로 실행되는 (리붓마다) 방지하기 위해 여기서 "수동"으로 바꾸기
        - 따로 만들어둔 **dbstart.bat** 파일로 오라클 필요 때 마다 실행하는 식으로 바꾸자.
          - OracleServiceSTR -> DB STR 기동!
          - OracleOraDB19Home1TNSListenerLISTENERR -> 리스너 기동!
      - **오라클 삭제는 오라클 홈 디렉토리에 deinstall로 삭제하는거니까 주의**
  
- **Orange는 64bit 에 dbau(유니코드) 버전 설치 -> 클라이언트 32bit 설치해버려서 Orange도 32bit 하자.**
    - **[추가 오렌지 참고 문서](https://m.blog.naver.com/skeletonflower/222147717396), [추가 참고+instance client 활용ver](https://hoing.io/archives/153#__70)**
    
      - instance client 활용 ver은 다음에 뭐 할 일 있으면 하고! 지금은 11버전 client 설치해서 성공 했다.
    
    - 공식홈페이지 문구 주의 : Oracle Server 7.3 이상을 지원하며 Oracle Client 8.0.6이상을 설치하셔야 사용할 수 있습니다. (UNICODE) Oracle Client 9.2 이상
    
    - 관리자로 설치
    
    - **Oracle Client** 어.. 이거 다른곳에 한개 더 깔려 있을걸..? 경로 기억 안ㄴㄴ.ㅏ.ㅁ.. 아님말..고
    
      - Oracle Base: C:\developer\app\oracle-client
      - Oracle Home: C:\developer\app\oracle-client\product\11.2.0\client_1
      - **sibar 에러 ORA-12560: TNS:프로토콜 어댑터 오류 뜸. 환장하겠네;**
        - 리스너가 문제 있을 시 뜨는 오류라 하나보다. [해결 문서](https://200-rush.tistory.com/entry/ORA-12560-Listener)
        - 현재 오라클 서버, 클라이언트 모두 설치했기에 sqlplus가 서버꺼인지 클라꺼인지 확인필요.
          - virtualbox 리눅스로 했으면 오라클 서버 따로 구동했으니 이런 에러도 안떳을텐데 ㅠ
          - **환경변수에 보면 "클라"께 위로 우선순위 되어있다 (PATH경로). "서버"를 위로 올리자.**
    
    - **내 컴퓨터 (윈도우) 의 오라클 CLIENT의 TNSNAMES.ORA 파일의 TNS 정보 <-> ORACLE DATABASE 서버(LINUX.난 윈도우.)가 (LISTENER) 연결되어야한다.**
    
      - port=1521, ip=?
    
      - 오라클 CLIENT 설치된 서버의 tnsnames.ora 수정!!
    
        - ```
          TNS별칭 =
            (DESCRIPTION =
              (ADDRESS = (PROTOCOL = TCP)(HOST = 오라클 db 서버 ip)(PORT = db port))
              (CONNECT_DATA =
                (SERVER = DEDICATED)
                (SERVICE_NAME = db sid)
              )
            )
          ```
    
        - ```
          // 해당 내용 추가
          STR =
            (DESCRIPTION =
              (ADDRESS = (PROTOCOL = TCP)(HOST = 192.168.??.??)(PORT = 1521))
              (CONNECT_DATA =
                (SERVER = DEDICATED)
                (SERVICE_NAME = STR)
              )
            )
          ```
    
      - 이러면 이제 오렌지 TNS에 뜬다!! 물론, ORA-28040 에러 도함꼐 ㅋㅋㅋ
    
        - Oracle Database, Oracle Database Client 둘의 버전이 맞지 않아서 뜨는 오류!
    
        - Oracle Database쪽의 sqlnet.ora 를 수정하자.
    
        - ```
          # sqlnet.ora 파일 수정 (추가)
          
          SQLNET.ALLOWED_LOGON_VERSION_CLIENT = 10
          SQLNET.ALLOWED_LOGON_VERSION_SERVER = 10
          ```
    
      - **드디어 성공!! (참고 설정과 팁 - 오렌지)** 흑ㄹ흙... 진짜... 삽질 너무했다 이번에 ㅠㅠ
    
        - 한번에 조회되는 SQL 길이 늘이기 -> 값이 너무 길면 중간에 잘리는 현상 방지
          - Tools -> Orange Options -> Common -> Session -> Array Size, Long 수정 (5000,10000쯤?)
        - 한번에 조회하는 row 수 늘리기 
          - Tools -> Orange Options -> SQL Tool -> General -> Initial Fetch , Next Fetch 수정
          - 또한 Fetch as Need 체크박스 해제하면 그냥 전체 row건이 항상 조회!
        - 단축키
          - sql 실행 : ctrl + enter  
            전체 실행 : F5
          - 주석처리 : ctrl + -  
            주석처리 해제 : ctrl + shift + -
          - sql문 재배치 : (드래그)ctrl + shift +f
          - 저장 : ctrl + s  
            불러오기 : ctrl + o  
            새로운 탭 : ctrl + t
          - 모두 소문자 : ctrl + u   
            모두 대문자 : ctrl + shift + u
          - Logon 창 띄우기 : ctrl + n 
            - 계정 변경 (계정마다 소유의 테이블이 다르기 때문)
            - 한번 맺었던 세션은 위에 남아있음
    
- 참고

  - **HOST** : IP나 도메인을 가진 장치(컴퓨터).
  - **CLIENT** : HOST중에 정보를 요청하는 장치(컴퓨터).
  - **SERVER** : 요청받은 정보를 제공하는 장치(컴퓨터).
  - **오라클에서의 서버** : 오라클 데이터베이스가 설치된 장치(컴퓨터).
  - **오라클에서의 클라이언트** : 네트워크를 통해서 데이터베이스를 제어하기 위한 소프트웨어(SQL Plus, SQL Developer, TOAD)를 사용하는 장치(컴퓨터).

  - 오라클 버전별 특징도 다르니 주의
    - **시퀀스와 트리거**: 구버전 오라클이나 특정 요구사항에 따라 사용.
    - **IDENTITY 컬럼**: 오라클 12c 이상에서 지원, 더 간편하게 사용할 수 있음.

**UDP 통신..?**

- 흠..

**서비스단과 UDP통신단을 분리해야하는지??**

- 

<br><br>

## 2024-09-06

ERD 생각. + 뤼튼 도움. 기능별 쿼리문 뤼튼 참고.

1. **User** 테이블
   - user_id (PK)
   - username
   - password
   - created_at
2. **ChatRoom** 테이블
   - room_id (PK)
   - room_name
   - created_at
3. **Message** 테이블
   - message_id (PK)
   - room_id (FK)
   - user_id (FK)
   - message_content
   - timestamp
4. **UserChatRoom** 테이블 (다대다 관계)
   - user_id (FK)
   - room_id (FK)

<br><br>

## 2024-09-03

젤 많이 참고코드 : https://velog.io/@skadnwls7896/JAVA-%EB%8B%A4%EC%A4%91-%EC%B1%84%ED%8C%85-%ED%94%84%EB%A1%9C%EA%B7%B8%EB%9E%A8#%EC%8B%A4%ED%96%89-%ED%99%94%EB%A9%B4
혹시나 채팅내역 스레드 나눈코드 필요하면 : https://ssons.tistory.com/50
자바 소켓 클래스 개념 : https://ssons.tistory.com/49
자바 tcp, udp 클래스 개념 : https://structuring.tistory.com/157

+) 정말 추후에 챗봇 추가(AI 캐릭터 봇) -> 지금 뤼튼에 있는거 추가할 생각. 걍 해보고 싶음.

스윙 플젝은 간단히 채팅 플젝.
멀티스레드 환경으로 구성 + 채팅은 tcp통신, 회원가입은 udp통신 + GUI는 스윙(중요한게 아님 디자인+코드는 GPT로)
-> 회원가입 부분 구이는 워드파일 참고
-> 그냥 자바 코드로만 진행! + DB는 반드시 오라클 사용해보기! 툴도 함께!(내 힘으로 ERD 구축하되 AI 검증은 받아보자.)
-> DB MyBatis 쓰자! DB 튜닝을 이걸로~!!! 다만 MyBatis 연습용인거임. 스윙플젝에 사실 MyBatis는 딱히..ㅜ 은행같이 복잡한 쿼리문 사용에 좋을 뿐.


해당 플젝은 금방 끝날 프로젝트. 그냥 토이프로젝트일 뿐.
하는 "목적"은 TCP,UDP 통신 + 멀티스레드 환경 직접 구성 이다~
항상 spring(웹)이든 python이든 http통신을 사용함으로써 실시간 통신은 해본적이 없었다.
이번엔 실시간 통신을 위해 TCP, UDP 통신을 사용한다! 
=> 물론, spring에도 tcp,udp 통신 지원 라이브러리 있다~ 어차피 자바인데 당연. tcp통신을 자바에선 자바의 소켓 라이브러리 사용이니.
=> 그럼 웹소켓은? 클라가 웹이면 웹소켓 사용! 우린 swing 쓸거니까 그냥 소켓 사용!

TCP는 1:1 양방향 통신이고,
UDP는 1:N 통신이며 전달 순서 보장 불가. 예로 들면, 대상이 정해지지 않은 라디오 또는 방송에서 사용된다. 
순간의 통신 오류 정도야 큰 문제가 없으며, 
대상이 정해지지 않으므로 중요하지 않은 데이터들을 전송할 때 사용된다.

개념적으론 OSI 7계층 생각해보면 http가 응용계층이고 하위가 TCP,UDP전송계층이라서 비슷한지 다른지 애매한 느낌이다.
이렇게 기억해두자 -> HTTP는 단기적인 TCP 커넥션을 하고 종료한다고.

참고) WebSocket(웹소켓) 통신은 클라이언트와 서버(브라우저와 서버)를 연결하고 실시간으로 통신이 가능하도록 하는 첨단 기술 (http는 실시간X. 물론 http polling 같은걸로 가능은 함)
HTTP 프로토콜 통신 도 결국 소켓 통신을 기반으로 한다. TCP 프로토콜 계층 위에 존재하는(응용 계층) HTTP 또한 소켓 통신을 기반으로 하고, IP와 Port 번호 등이 존재하는 TCP/IP 헤더들이 붙여져 메시지가 송수신된다.
다만 둘을 구분하는 이유는 HTTP 프로토콜 통신의 경우 한쪽에서만 요청에 대한 응답을 하는 웹 통신에 특화되어있기에, 또는 이러한 통신을 위해 일반적인 소켓 통신 매커니즘과 다르기 때문에 구분하는 것이다.
https://velog.io/@sangje112/http-vs-WebSocket-http-%ED%86%B5%EC%8B%A0%EA%B3%BC-WebSocket%EC%9D%98-%EC%9E%A5%EB%8B%A8%EC%A0%90
